<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>
    
    Jaime o garoto quer Make !
    
  </title>
  <meta name="description" content="  ">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/favicon.ico">

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.0/css/materialize.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/syntax.css">

  <script src="/js/highlight.js"></script>
  <script src="/js/jquery.min.js"></script>

  <link rel="canonical" href="http://cristianounix.github.io//2015/07/25/jaime-o-menino-quer-make/">

</head>

<body class="home-template grey lighten-5">

    
<nav id="toolbar" class="navbar navbar-inverse navbar-fixed-top" style="position:fixed; z-index: 10;">
   <div class="nav-wrapper blue">
     <ul id="nav-mobile" class="left hide-on-med-and-down">
       <li><a href="http://twitter.com/cristianounix" target="_blank"><i class="fa fa-twitter-square"></i></a></li>
       <li><a href="http://github.com/cristianounix" target="_blank"><i class="fa fa-github-square"></i></a></li>
       <li><a href="http://instagram.com/cristianounix" target="_blank"><i class="fa fa-instagram"></i></a></li>
       <li><a href="http://br.linkedin.com/in/cristianounix/" target="_blank"><i class="fa fa-linkedin-square"></i></a></li>
       <li><a href="/about"><i class="fa fa-user"></i></a></li>
     </ul>

     <a href="/" class="brand-logo center">
       <img src="/img/cristianounix-mustache.png" alt="" />
     </a>

     <a href="#" data-activates="mobile-menu-top" class="button-collapse"><i class="material-icons">menu</i></a>

     <ul class="left side-nav" id="mobile-menu-top">
       <li><a href="http://twitter.com/cristianounix" target="_blank">Twitter</a></li>
       <li><a href="http://github.com/cristianounix" target="_blank">Github</a></li>
       <li><a href="http://instagram.com/cristianounix" target="_blank">Instagram</a></li>
       <li><a href="http://br.linkedin.com/in/cristianounix/" target="_blank">Linkedin</a></li>
       <li><a href="/about">Sobre mim</a></li>
     </ul>
   </div>
 </nav>


    <main class="content" role="main">

  <section id="blog-intro" class="cyan section z-depth-1 article-intro" style="background-image:url('https://d262ilb51hltx0.cloudfront.net/max/2000/1*278tqw9zNPe2WCAz29Wzdw.jpeg');"></section>

  <section id="main-inner-container" class="container">
    <article class="post tag-webdev tag-gruntjs tag-javascript tag-nodejs card-panel z-depth-1 article-container">
      <header>
        <time class="post-date grey-text" datetime="2015-07-25 00:00:00 -0300"><i class="fa fa-clock-o"></i> 25 July 2015</time>
        <h1>Jaime o garoto quer Make !</h1>
          <div class="tag-cloud">
            <span>
                <i class="mdi-maps-local-offer"></i>
                
            </span>
          </div>
      </header>
      <section class="post-content">
        <p style="text-align: center;">
  <img src="/img/posts/make-makefile.png" alt="Make - Makefile" style="height:350px;" />
</p>

<p>Hoje em dia só se fala em automatização de tarefas e etc etc, e com isso surgiram ferramentas fantásticas como Grunt, Gulp e outras que devem existir por esse mundão a fora.</p>

<p>Show !</p>

<p>Mas se voltarmos um pouco no tempo vamos encontrar um cara chamado <code>MAKE</code>, sim o velho e querido make, quem já instalou algum programa em alguma distribuição unix-like usando os fontes sabe bem do quem estou falando.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>./configure
<span class="nv">$ </span>make
<span class="nv">$ </span>make install</code></pre></div>

<p>Esse era o processo básico pra instalar o programa.</p>

<p>Mas junto com isso você tinha que resolver problemas de dependências, caminhos de arquivos, permissões, versão e em último caso ligava ou chamava quele amigo que manjava muito de linux e pedia aquela ajuda quase chorando porque foi vencido pelo maldito pacote….</p>

<p>Muitos podem ver com algo ruim e etc, mas observe melhor, isso faz com que você entenda para onde os arquivos estão indo, que para um programa funcionar ele depende de outros ou de outras bibliotecas, que você tem que ter uma permissão especial em determinados arquivos em em outros não e etc…</p>

<p>Bem, voltando ao assunto principal….</p>

<p>Tá mas que diabos é o Make e qual a relação dele com o Grunt ou Glup ?</p>

<h4 id="make">Make</h4>

<blockquote>
  <p>Basicamente o MAKE é um atomatizador de tarefas em ambientes unix que foi e é muito usado para compilar programas.</p>
</blockquote>

<p><strong><em>Agora vocês entenderam a relação com o Gulp/Grunt ??</em></strong></p>

<p>No processo básico de instalação que falei acima o que acontecia era o seguinte:</p>

<ol>
  <li>
    <p><code>$ ./configure</code> era um script que depois de executado com sucesso criava o arquivo <code>Makefile</code></p>
  </li>
  <li>
    <p><code>Makefile</code> é o arquivo que dizia ao <strong>make</strong> quais eram as tarefas a serem realizadas para compilar o programa, essas tarefas eram feitas numa ordem topologica respeitando as dependências dos arquivos</p>
  </li>
  <li>
    <p><code>$ make install</code> esse comando chamava uma tarefa que estava definida no makefile e que tinha como objetivo fazer a instalação do programa compilado anteriormente</p>
  </li>
</ol>

<p style="text-align: center;">
  <img src="/img/posts/graph.png" alt="Make - Topological" style="height:350px;" />
</p>

<p>Veja mais sobre ordenação topologica <a href="https://en.wikipedia.org/wiki/Topological_sorting">aqui</a>, mas acho que futuramente faço um post sobre algum algoritimos de ordenação.</p>

<hr />

<p>O Make é nativo das plataformas linux, mas caso não tenha basta instalar o pacote <code>build-essential</code></p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>apt-get install build-essential</code></pre></div>

<p>Antes de brincarmos com o make seria bom criar uma pasta em qualquer lugar de sua preferência, e dentro dela vamos criar nosso arquivo <code>Makefile</code>.</p>

<p>No arquivo (makefile) que criamos vamos colocar esse conteúdo (respeitando as tabulações):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">string</span> <span class="o">=</span> <span class="s2">&quot;Finalizando...&quot;</span>

all: task_all

task_all: dep1 dep2 dep3
	@echo <span class="k">$(</span>string<span class="k">)</span>
	@echo <span class="s2">&quot;Pronto !!&quot;</span>

dep1:
	@echo <span class="s2">&quot;Dependencia 1 &quot;</span>

dep2:
	@echo <span class="s2">&quot;Dependencia 2 &quot;</span>

dep3:
	@echo <span class="s2">&quot;Dependencia 3 &quot;</span>
	@echo</code></pre></div>

<p>Agora via terminal e dentro dessa pasta execute o make.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make
----------------
Dependencia 1
Dependencia 2
Dependencia 3

Finalizando...
Pronto !!</code></pre></div>

<p>Legal né ?</p>

<p>Se quiser mudar a ordem de execução só alterar a linha abaixo:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">task_all: dep1 dep2 dep3</code></pre></div>

<p>Para:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">task_all: dep3 dep2 dep1</code></pre></div>

<p>Execute o make e observe a saida novamente, (percebeu que a ordem mudou ?!).</p>

<p>Você também pode chamar uma tarefa especifica, assim:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make dep2</code></pre></div>

<h4 id="vamos-fazer-algo-til">Vamos fazer algo útil</h4>

<p>Agora que sabemos o básico do make, vamos pensar em como poderiamos substituir uma tarefa simples do grunt, nosso problema será esse:</p>

<ol>
  <li>Compilar nossos arquivos stylus</li>
  <li>Concatenar todos os arquivos</li>
  <li>Minificar</li>
</ol>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Compila, concatena e minifica todos os arquivos de estilo</span>
<span class="c"># Obs: verifica se você tem disponivel os executaveis globalmente,</span>
<span class="c">#     senão terá que colocar o path deles</span>

<span class="nv">PATH_STYL</span><span class="o">=</span>styl/*.styl
<span class="nv">PATH_CSS</span><span class="o">=</span>css
<span class="nv">STYLUS_CMD</span><span class="o">=</span>stylus
<span class="nv">CONCAT_CMD</span><span class="o">=</span>cat 
<span class="nv">CONCAT_PATH</span><span class="o">=</span>styl/header.css styl/body.css styl/footer.css &gt; css/style.css
<span class="nv">UGLIFY_CMD</span><span class="o">=</span>uglify
<span class="nv">UGLIFY_PATH</span><span class="o">=</span>-s ./css/style.css -o ./css/style.min.css -c

all: task_all

task_all: compile concat minify clean
	@echo <span class="s2">&quot;Pronto !!&quot;</span>

compile:
	<span class="k">$(</span>STYLUS_CMD<span class="k">)</span> <span class="k">$(</span>PATH_STYL<span class="k">)</span>
	@echo <span class="s2">&quot;Stylus compilado...&quot;</span>

concat:
	<span class="k">$(</span>CONCAT_CMD<span class="k">)</span> <span class="k">$(</span>CONCAT_PATH<span class="k">)</span>
	@echo <span class="s2">&quot;Concatenando...&quot;</span>

minify:
	<span class="k">$(</span>UGLIFY_CMD<span class="k">)</span> <span class="k">$(</span>UGLIFY_PATH<span class="k">)</span>
	@echo <span class="s2">&quot;Minificando...&quot;</span>
 
clean:
	rm styl/*.css
	@echo <span class="s2">&quot;Limpando a bagunça...&quot;</span></code></pre></div>

<p style="text-align: center;">
A saída desse cara que nós acabamos de fazer vai ser algo assim:	
</p>

<p style="text-align: center;">
  <img src="/img/posts/gif-make-makefile-front.gif" alt="Make Makefile FrontEnd" />
</p>

<h5 id="vamos-tentar-deixar-um-pouco-mais-legal">Vamos tentar deixar um pouco mais legal.</h5>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Compila, concatena e minifica todos os arquivos de estilo</span>
<span class="c"># Obs: verifica se você tem disponivel os executaveis globalmente,</span>
<span class="c">#     senão terá que colocar o path deles</span>

<span class="nv">CSS_FINAL</span> <span class="o">=</span> css/style.min.css
<span class="nv">STYLUS_FILES</span> <span class="o">=</span> styl/header.styl <span class="se">\</span>
                 styl/body.styl <span class="se">\</span>
                 styl/footer.styl

<span class="nv">CSS_MIN</span> <span class="o">=</span> <span class="k">$(</span>STYLUS_FILES:.styl<span class="o">=</span>.min.css<span class="k">)</span> 

all: <span class="k">$(</span>CSS_FINAL<span class="k">)</span>
 
<span class="k">$(</span>CSS_FINAL<span class="k">)</span>: <span class="k">$(</span>CSS_MIN<span class="k">)</span>
	cat <span class="nv">$^</span> &gt;<span class="nv">$@</span>
	rm -f <span class="k">$(</span>CSS_MIN<span class="k">)</span>

%.min.css: %.styl
	stylus --compress &lt;<span class="nv">$&lt;</span> &gt;<span class="nv">$@</span>

clean:
	rm -f <span class="k">$(</span>CSS_FINAL<span class="k">)</span></code></pre></div>

<p><br /></p>

<hr />

<p><br /></p>

<h5 id="existem-alguns-variavis-do-make-que-devemos-saber">Existem alguns variavéis do Make que devemos saber:</h5>

<p><strong><em>$@</em></strong> - isso mostra o nome target atual:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">all: blabla
	@echo <span class="s2">&quot;Ei&quot;</span>
blabla:
	@echo <span class="nv">$@</span>

<span class="c"># Saída será:</span>
<span class="c"># 	blabla</span>
<span class="c">#	Ei</span></code></pre></div>

<p><strong><em>$&lt;</em></strong> - isso mostra o nome da primeira dependência:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">all: blabla vixi
	@echo <span class="s2">&quot;A dependencia desse target é&quot;</span> <span class="nv">$&lt;</span>

blabla:

vixi:

<span class="c"># Saída será:</span>
<span class="c"># 	A dependência desse target é blabla</span></code></pre></div>

<p><strong><em>[$^]</em></strong> - isso mostra a lsita das dependências do target:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">all: blabla vixi
	@echo <span class="s2">&quot;As dependências desse target são&quot;</span> <span class="nv">$^</span>

blabla:

vixi:

<span class="c"># Saída será:</span>
<span class="c"># 	As dependências desse target são blabla vixi</span></code></pre></div>

<p><strong><em>[$?]</em></strong> - Lista de todos arquivos de dependências mais recentes que a regra, a lista de arquivos é separada por espaço:</p>

<p>Crie 2 ou mais arquivos *.txt na pasta que irá ficar esse teste do makefile e coloquei qualquer texto dentro deles.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">HEAD_CMD</span><span class="o">=</span>head
<span class="nv">FILES</span><span class="o">=</span><span class="k">$(</span>shell find . -name <span class="s1">&#39;*.o&#39;</span><span class="k">)</span>

show: <span class="k">$(</span>FILES<span class="k">)</span>
	<span class="k">$(</span>HEAD_CMD<span class="k">)</span> <span class="nv">$?</span>

<span class="c"># Saída será:</span>
<span class="c">#	head file1.txt file2.txt file3.txt [...]</span>
<span class="c">#	==&gt; file1.txt &lt;==</span>
<span class="c">#	[CABECALHO_1]</span>
<span class="c">#	==&gt; file2.txt &lt;==</span>
<span class="c">#	[CABECALHO_2]</span></code></pre></div>

<p><strong><em>[$*]</em></strong> - Nome do arquivo sem a extensão:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">CSS_FINAL</span> <span class="o">=</span> css/style.min.css
<span class="nv">STYLUS_FILES</span> <span class="o">=</span> styl/header.styl  <span class="se">\</span>
                 styl/body.styl <span class="se">\</span>
                 styl/footer.styl

<span class="nv">CSS_MIN</span> <span class="o">=</span> <span class="k">$(</span>STYLUS_FILES:.styl<span class="o">=</span>.min.css<span class="k">)</span> 

all: <span class="k">$(</span>CSS_FINAL<span class="k">)</span>
 
<span class="k">$(</span>CSS_FINAL<span class="k">)</span>: <span class="k">$(</span>CSS_MIN<span class="k">)</span>

%.min.css: %.styl
	@echo <span class="s2">&quot;Arquivo -&gt;&quot;</span> <span class="nv">$*</span>

<span class="c"># Saída será:</span>
<span class="c">#	Arquivo -&gt; styl/header</span>
<span class="c">#	Arquivo -&gt; styl/body</span>
<span class="c">#	Arquivo -&gt; styl/footer</span></code></pre></div>

<p>Muita coisa legal dá pra fazer com o Make.</p>

<p>Dá para por exemplo você se conectar via ssh ou ftp e fazer o upload ou download de arquivos, rodar um shell script  com diversas rotinas, você pode criar todo o setup da sua máquina colocando o make para instalar tudo que vc usa precisa: vim, mongodb, git, nodejs, sublime, brew, ou até mesmo configurar o deploy de sua aplicação, etc etc….</p>

<p>Isso só foi o ponto de partida, foi o básico do básico do básico e mais um pouco básico do que o make faz….</p>

<h5 id="vocs-trocariam-seu-gruntfile-ou-semelhantes-por-um-makefile-">Vocês trocariam seu Gruntfile (ou semelhantes) por um Makefile ?</h5>

<blockquote>
  <p>Haa não tô dizendo que as outras ferramentas são ruins, ou que não se deve usar elas, quero chamar atenção para as ferramentas que já estão aqui a muito muito tempo e não conhecemos tão bem quanto pensamos.</p>
</blockquote>

<p><br /></p>

<p>Ps: Lembre-se que tudo isso só é possivél estando fora da win-matrix, então faça sua escolha e tome a pilula vermelha, pq só assim conseguirá ver fora da janela :)</p>

<p><br /></p>

<p>Referência suprema &gt; <a href="http://www.gnu.org/software/make/manual/make.html" target="_blank">Manual Make</a></p>


        <p>
          
        </p>
      </section>


      <footer>
        <section id="social-share">
          <p>
            Compartilhar: <br>
            <a href="http://twitter.com/share?text=&amp;url=" target="_new" class="btn-floating white cyan-text darken-2" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="fa fa-twitter cyan-text darken-2"></i></a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="btn-floating white cyan-text"><i class="fa fa-facebook cyan-text darken-2"></i></a>
            <a href="https://plus.google.com/share?url=" class="btn-floating white cyan-text darken-2" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;"><i class="fa fa-google-plus cyan-text darken-2 "></i></a>
          </p>
        </section>
        <!-- Disqus Comments -->
        <section class="comments">
          <div id="disqus_thread"></div>
              <script type="text/javascript">
                  var disqus_shortname = 'cristianounix';
                  (function() {
                      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              </script>
              <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </section>
      </footer>
    </article>
  </section>
</main>


  <footer class="site-footer clearfix">

  </footer>

  
<script src="/js/EasePack.min.js"></script>
<script src="/js/TweenLite.min.js"></script>
<script src="/js/materialize.min.js"></script>
<script src="/js/main.js"></script>



</body>

</html>